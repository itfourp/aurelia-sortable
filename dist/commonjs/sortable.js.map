{"version":3,"sources":["../../src/sortable.js"],"names":["SORTABLE_ITEM","Sortable","Element","element","drag","autoScroll","selector","fromIx","toIx","x","y","lastElementFromPointRect","options","strategy","REMOVE_IF_POINTERS_GT","activate","removeListener","on","scroll","document","scrollingElement","documentElement","body","viewportScroll","removeScroll","bindScroll","onScroll","bind","closest","deactivate","attached","detached","fn","addEventListener","removeEventListener","scrollLeft","scrollTop","update","axis","dragMinPosX","dragMaxPosX","dragMinPosY","dragMaxPosY","getPoint","tryMove","getScrollFrames","maxPos","scrollPos","Math","max","ceil","abs","scrollSpeed","getScrollDirectionX","left","right","dir","scrollSensitivity","getScrollDirectionY","top","bottom","hide","display","style","rootElement","valid","parentNode","getItemViewModel","au","viewModel","moveSortingItem","items","indexOf","item","move","splice","tryUpdate","offsetX","offsetY","showFn","clone","pointInside","rect","elementFromPoint","canThrottle","vm","getBoundingClientRect","allowMove","ctx","$index","pageX","pageY","getCenterY","getCenterX","down","e","data","allowDrag","event","preventDefault","undefined","start","windowHeight","innerHeight","windowWidth","innerWidth","pointers","client","sortableRect","scrollRect","scrollWidth","scrollHeight","boundingRect","min","sortableContainsScroll","contains","scrollMaxPosX","width","scrollMaxPosY","height","sortingViewModel","dragZIndex","sortingClass","p","scrollX","active","scrollY","dirX","dirY","frameCntX","frameCntY","end","stop","moved","cancel","disallowedDragTagNames","args","target","tagName","isContentEditable","SortableItem","overrideCtx"],"mappings":"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","file":"sortable.js","sourcesContent":["import {DOM} from \"aurelia-pal\";\r\nimport {customAttribute, bindable} from \"aurelia-templating\";\r\nimport {inject, transient} from \"aurelia-dependency-injection\";\r\nimport {oribella, matchesSelector, STRATEGY_FLAG} from \"oribella-default-gestures\";\r\nimport {Drag} from \"./drag\";\r\nimport {AutoScroll} from \"./auto-scroll\";\r\n\r\nconst SORTABLE_ITEM = \"oa-sortable-item\";\r\n\r\n@customAttribute(\"oa-sortable\")\r\n@inject(DOM.Element, Drag, AutoScroll)\r\n@transient()\r\nexport class Sortable {\r\n\r\n  @bindable scroll = null;\r\n  @bindable scrollSpeed = 10;\r\n  @bindable scrollSensitivity = 10;\r\n  @bindable items = [];\r\n  @bindable sortingClass = \"oa-sorting\";\r\n  @bindable draggingClass = \"oa-dragging\";\r\n  @bindable axis = \"\";\r\n  @bindable moved = () => {};\r\n  @bindable dragZIndex = 1;\r\n  @bindable disallowedDragTagNames = [\"INPUT\", \"SELECT\", \"TEXTAREA\"];\r\n  @bindable allowDrag = args => {\r\n    if (this.disallowedDragTagNames.indexOf(args.event.target.tagName) !== -1) {\r\n      return false;\r\n    }\r\n    if (args.event.target.isContentEditable) {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n  @bindable allowMove = () => { return true; };\r\n\r\n  selector = \"[\" + SORTABLE_ITEM + \"]\";\r\n  fromIx = -1;\r\n  toIx = -1;\r\n  x = 0;\r\n  y = 0;\r\n  lastElementFromPointRect = null;\r\n\r\n  constructor(element, drag, autoScroll) {\r\n    this.element = element;\r\n    this.drag = drag;\r\n    this.autoScroll = autoScroll;\r\n    this.options = {\r\n      strategy: STRATEGY_FLAG.REMOVE_IF_POINTERS_GT\r\n    };\r\n  }\r\n  activate() {\r\n    this.removeListener = oribella.on(this.element, \"swipe\", this);\r\n    let scroll = this.scroll;\r\n    if (typeof scroll === \"string\") {\r\n      if (scroll === \"document\") {\r\n        this.scroll = document.scrollingElement || document.documentElement || document.body;\r\n        this.viewportScroll = true;\r\n        this.removeScroll = this.bindScroll(document, this.onScroll.bind(this));\r\n        return;\r\n      } else {\r\n        scroll = this.closest(this.element, scroll);\r\n      }\r\n    }\r\n    this.scroll = scroll;\r\n    if (!(this.scroll instanceof DOM.Element)) {\r\n      this.scroll = this.element;\r\n    }\r\n    this.removeScroll = this.bindScroll(this.scroll, this.onScroll.bind(this));\r\n  }\r\n  deactivate() {\r\n    if (typeof this.removeListener === \"function\") {\r\n      this.removeListener();\r\n    }\r\n    if (typeof this.removeScroll === \"function\") {\r\n      this.removeScroll();\r\n    }\r\n  }\r\n  attached() {\r\n    this.activate();\r\n  }\r\n  detached() {\r\n    this.deactivate();\r\n  }\r\n  bindScroll(scroll, fn) {\r\n    scroll.addEventListener(\"scroll\", fn, false);\r\n    return () => {\r\n      scroll.removeEventListener(\"scroll\", fn, false);\r\n    };\r\n  }\r\n  onScroll() {\r\n    if (!this.drag.element) {\r\n      return;\r\n    }\r\n    const { scrollLeft, scrollTop } = this.scroll;\r\n    this.drag.update(this.x,\r\n      this.y,\r\n      this.viewportScroll,\r\n      scrollLeft,\r\n      scrollTop,\r\n      this.axis,\r\n      this.dragMinPosX,\r\n      this.dragMaxPosX,\r\n      this.dragMinPosY,\r\n      this.dragMaxPosY);\r\n    const { x, y } = this.getPoint(this.x, this.y);\r\n    this.tryMove(x, y, scrollLeft, scrollTop);\r\n  }\r\n  getScrollFrames(maxPos, scrollPos) {\r\n    return Math.max(0, Math.ceil(Math.abs(maxPos - scrollPos) / this.scrollSpeed));\r\n  }\r\n  getScrollDirectionX(x, { left, right }) {\r\n    let dir = 0;\r\n    switch (this.axis) {\r\n      default:\r\n      case \"x\":\r\n      if (x >= right - this.scrollSensitivity) {\r\n        dir = 1;\r\n      } else if (x <= left + this.scrollSensitivity) {\r\n        dir = -1;\r\n      }\r\n      break;\r\n    }\r\n    return dir;\r\n  }\r\n  getScrollDirectionY(y, { top, bottom }) {\r\n    let dir = 0;\r\n    switch (this.axis) {\r\n      default:\r\n      case \"y\":\r\n      if (y >= bottom - this.scrollSensitivity) {\r\n        dir = 1;\r\n      } else if (y <= top + this.scrollSensitivity) {\r\n        dir = -1;\r\n      }\r\n      break;\r\n    }\r\n    return dir;\r\n  }\r\n  hide(element) {\r\n    const display = element.style.display;\r\n    element.style.display = \"none\";\r\n    return () => {\r\n      element.style.display = display;\r\n    };\r\n  }\r\n  closest(element, selector, rootElement = document) {\r\n    var valid = false;\r\n    while (!valid && element !== null && element !== rootElement &&\r\n      element !== document) {\r\n      valid = matchesSelector(element, selector);\r\n      if (valid) {\r\n        break;\r\n      }\r\n      element = element.parentNode;\r\n    }\r\n    return valid ? element : null;\r\n  }\r\n  getItemViewModel(element) {\r\n    return element.au[SORTABLE_ITEM].viewModel;\r\n  }\r\n  moveSortingItem(toIx) {\r\n    const fromIx = this.items.indexOf(this.drag.item);\r\n    this.move(fromIx, toIx);\r\n  }\r\n  move(fromIx, toIx) {\r\n    if (fromIx !== -1 && toIx !== -1 && fromIx !== toIx) {\r\n      this.items.splice(toIx, 0, this.items.splice(fromIx, 1)[0]);\r\n\t  this.toIx = toIx;\r\n    }\r\n  }\r\n  tryUpdate(x, y, offsetX, offsetY) {\r\n    const showFn = this.hide(this.drag.clone);\r\n    this.tryMove(x, y, offsetX, offsetY);\r\n    showFn();\r\n  }\r\n  pointInside(x, y, rect) {\r\n    return x >= rect.left &&\r\n      x <= rect.right &&\r\n      y >= rect.top &&\r\n      y <= rect.bottom;\r\n  }\r\n  elementFromPoint(x, y) {\r\n    let element = document.elementFromPoint(x, y);\r\n    if (!element) {\r\n      return null;\r\n    }\r\n    element = this.closest(element, this.selector, this.element);\r\n    if (!element) {\r\n      return null;\r\n    }\r\n    return element;\r\n  }\r\n  canThrottle(x, y, offsetX, offsetY) {\r\n    return this.lastElementFromPointRect &&\r\n      this.pointInside(x + offsetX, y + offsetY, this.lastElementFromPointRect);\r\n  }\r\n  tryMove(x, y, offsetX, offsetY) {\r\n    if (this.canThrottle(x, y, offsetX, offsetY)) {\r\n      return;\r\n    }\r\n    const element = this.elementFromPoint(x, y);\r\n    if (!element) {\r\n      return;\r\n    }\r\n    const vm = this.getItemViewModel(element);\r\n    this.lastElementFromPointRect = element.getBoundingClientRect();\r\n    if (!this.allowMove({ item: vm.item })) {\r\n      return;\r\n    }\r\n    this.moveSortingItem(vm.ctx.$index);\r\n  }\r\n  getPoint(pageX, pageY) {\r\n    switch (this.axis) {\r\n    case \"x\":\r\n      pageY = this.drag.getCenterY();\r\n      break;\r\n    case \"y\":\r\n      pageX = this.drag.getCenterX();\r\n      break;\r\n    default:\r\n      break;\r\n    }\r\n    return {\r\n      x: pageX,\r\n      y: pageY\r\n    };\r\n  }\r\n  down(e, data, element) {\r\n    if (this.allowDrag({ event: e, item: this.getItemViewModel(element).item })) {\r\n      e.preventDefault();\r\n      return undefined;\r\n    }\r\n    return false;\r\n  }\r\n  start(e, data, element) {\r\n    const { scrollLeft, scrollTop } = this.scroll;\r\n\r\n    this.windowHeight = innerHeight;\r\n    this.windowWidth = innerWidth;\r\n    this.x = data.pointers[0].client.x;\r\n    this.y = data.pointers[0].client.y;\r\n    this.sortableRect = this.element.getBoundingClientRect();\r\n\r\n    this.scrollRect = this.scroll.getBoundingClientRect();\r\n    this.scrollWidth = this.scroll.scrollWidth;\r\n    this.scrollHeight = this.scroll.scrollHeight;\r\n\r\n    this.boundingRect = {\r\n      left: Math.max(0, this.sortableRect.left),\r\n      top: Math.max(0, this.sortableRect.top),\r\n      bottom: Math.min(this.windowHeight, this.sortableRect.bottom),\r\n      right: Math.min(this.windowWidth, this.sortableRect.right)\r\n    };\r\n\r\n    this.sortableContainsScroll = this.element.contains(this.scroll);\r\n    if (this.sortableContainsScroll) {\r\n      this.scrollMaxPosX = this.scrollWidth - this.scrollRect.width;\r\n      this.scrollMaxPosY = this.scrollHeight - this.scrollRect.height;\r\n      this.dragMinPosX = this.sortableRect.left;\r\n      this.dragMaxPosX = this.sortableRect.left + this.scrollWidth;\r\n      this.dragMaxPosY = this.sortableRect.top + this.scrollHeight;\r\n      this.dragMinPosY = this.sortableRect.top;\r\n    } else {\r\n      this.scrollMaxPosX = this.sortableRect.right - this.windowWidth + (this.viewportScroll ? scrollLeft : 0);\r\n      this.scrollMaxPosY = this.sortableRect.bottom - this.windowHeight + (this.viewportScroll ? scrollTop : 0);\r\n      this.dragMinPosX = this.sortableRect.left + scrollLeft;\r\n      this.dragMaxPosX = this.scrollMaxPosX + this.windowWidth;\r\n      this.dragMinPosY = this.sortableRect.top + scrollTop;\r\n      this.dragMaxPosY = this.scrollMaxPosY + this.windowHeight;\r\n    }\r\n\r\n    this.sortingViewModel = this.getItemViewModel(element);\r\n    this.fromIx = this.sortingViewModel.ctx.$index;\r\n    this.toIx = -1;\r\n\r\n    this.drag.start( element,\r\n      this.sortingViewModel.item,\r\n      this.x, this.y,\r\n      this.viewportScroll,\r\n      scrollLeft,\r\n      scrollTop,\r\n      this.dragZIndex,\r\n      this.axis, this.sortingClass,\r\n      this.dragMinPosX,\r\n      this.dragMaxPosX,\r\n      this.dragMinPosY,\r\n      this.dragMaxPosY);\r\n    this.autoScroll.start(this.scrollSpeed);\r\n    this.lastElementFromPointRect = this.drag.rect;\r\n  }\r\n  update(e, data) {\r\n    const p = data.pointers[0].client;\r\n    const { scrollLeft, scrollTop } = this.scroll;\r\n    this.x = p.x;\r\n    this.y = p.y;\r\n    this.drag.update(this.x,\r\n      this.y,\r\n      this.viewportScroll,\r\n      scrollLeft,\r\n      scrollTop,\r\n      this.axis,\r\n      this.dragMinPosX,\r\n      this.dragMaxPosX,\r\n      this.dragMinPosY,\r\n      this.dragMaxPosY);\r\n    const { x, y } = this.getPoint(p.x, p.y);\r\n    const scrollX = this.autoScroll.active ? scrollLeft : 0;\r\n    const scrollY = this.autoScroll.active ? scrollTop : 0;\r\n    this.tryUpdate(x, y, scrollX, scrollY);\r\n\r\n    const dirX = this.getScrollDirectionX(x, this.boundingRect);\r\n    const dirY = this.getScrollDirectionY(y, this.boundingRect);\r\n    let frameCntX = this.getScrollFrames(dirX === -1 ? 0 : this.scrollMaxPosX, scrollLeft);\r\n    let frameCntY = this.getScrollFrames(dirY === -1 ? 0 : this.scrollMaxPosY, scrollTop);\r\n    if ((dirX === 1 && scrollLeft >= this.scrollMaxPosX) ||\r\n      (dirX === -1 && scrollLeft === 0)) {\r\n      frameCntX = 0;\r\n    }\r\n    if ((dirY === 1 && scrollTop >= this.scrollMaxPosY) ||\r\n      (dirY === -1 && scrollTop === 0)) {\r\n      frameCntY = 0;\r\n    }\r\n    this.autoScroll.update(this.scroll, dirX, dirY, frameCntX, frameCntY);\r\n  }\r\n  end() {\r\n    if (!this.drag.item) {\r\n      return; //cancelled\r\n    }\r\n    this.stop();\r\n    if (this.fromIx !== this.toIx) {\r\n      this.moved( { fromIx: this.fromIx, toIx: this.toIx, items: this.items } );\r\n    }\r\n  }\r\n  cancel() {\r\n    this.move(this.sortingViewModel.ctx.$index, this.fromIx);\r\n    this.stop();\r\n  }\r\n  stop() {\r\n    this.drag.end();\r\n    this.autoScroll.end();\r\n  }\r\n}\r\n\r\n@customAttribute(\"oa-sortable-item\")\r\nexport class SortableItem {\r\n\r\n  @bindable item = null;\r\n\r\n  bind(ctx, overrideCtx) {\r\n    this.ctx = overrideCtx; //Need a reference to the item's $index\r\n  }\r\n}\r\n"]}